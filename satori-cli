#!/usr/bin/python3
# -*- coding: utf-8 -*-
import argparse
import sys
import requests


def run(playbook, token):
    response = requests.post(
        f"https://w7zcm8h3h1.execute-api.us-east-2.amazonaws.com/staging/",
        files={"playbook": playbook},
        headers={"Authorization": f"token {token}"})
    print(f"{response.status_code = }\n{response.text = }")


def report(uuid):
    pass # TODO


if __name__ == "__main__":
    parser = argparse.ArgumentParser(add_help=True, exit_on_error=True)

    sub_parsers = parser.add_subparsers(dest="subcommand")

    run_cmd = sub_parsers.add_parser("run")
    run_cmd.add_argument("token", metavar="TOKEN")
    run_cmd.add_argument("-p", "--playbook", type=argparse.FileType("rb"))

    report_cmd = sub_parsers.add_parser("report")
    report_cmd.add_argument("token", metavar="TOKEN")
    report_cmd.add_argument("uuid", metavar="REPORT_UUID")

    args = parser.parse_args()

    if len(sys.argv) <= 1:
        parser.print_help()
        sys.exit(0)

    if args.subcommand == "run":
        run(args.playbook, args.token)
    elif args.subcommand == "report":
        report(args.uuid)
