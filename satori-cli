#!/usr/bin/python3
# -*- coding: utf-8 -*-
import sys
import  getopt
import requests

def main(argv):
    headers = None
    files = None
    try:
        options = "rut:"
        long_options = ["run-playbook=", "upload=", "set-token="]
        opts, args = getopt.getopt(argv, options, long_options)
    except getopt.GetoptError:
        print('satori-cli --run-playbook <example.yml> --set-token <outputfile>')
        sys.exit(2)
    for opt, arg in opts:
        if opt in ("-t", "--set-token"):
            print(f"{arg = }")
            headers = {'Authorization': f"token {arg}"}
        elif opt in ("-r", "--run-playbook"):
            print(f"{arg = }")
            files = {
                'playbook': open(arg,'rb'),
                #'code': open("./playbooks/devops/GitHub.tar.gz",'rb')
            }
        elif opt in ("-u", "--upload"):
            # TO DO
            sys.exit()
    if headers is not None and files is not None:
        response = requests.post(f"https://w7zcm8h3h1.execute-api.us-east-2.amazonaws.com/staging/", files=files, headers=headers)
        print(f"{response.status_code = }\n{response.text = }")

if __name__ == "__main__":
   main(sys.argv[1:])
